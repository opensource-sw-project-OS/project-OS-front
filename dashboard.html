<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ëŒ€ì‹œë³´ë“œ</title>
  <style>
    header{
            position: fixed;

            /* í•˜ìœ„ìš”ì†ŒëŠ” íˆ¬ëª…ë„ ì ìš©ë˜ì§€ ì•Šë„ë¡ opacityì•„ë‹Œ rgba */
            background-color: rgb(255, 255, 255, 0.4);

            /* í™”ë©´ ë„ˆë¹„ì— ê½‰ì°¨ë„ë¡ */
            width: 100%;    

            /* ê°­ ì—†ì• ì£¼ê¸° */
            top: 0;
            left: 0;
            right: 0;
            height: 70px;

            /* ê·¸ë¦¼ì ìƒì„± */
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);

            align-items: center;
            padding:0 150px;
            /* ì§€ì •í•œ ì‚¬ì´ì¦ˆ ë‚´ì— paddingë„ í¬í•¨ */
            box-sizing: border-box;
            
            display: flex;

            /* ë‘ ìš”ì†Œê°€ ì–‘ëìœ¼ë¡œ ê°€ë„ë¡ */
            /* justify-content: space-between; */
        }

    .title{
            white-space: nowrap;
            font-size:22px;
            font-weight: bold;
        }
    @font-face {
      font-family: 'SUIT';
      font-style: normal;
      font-weight: 400;
      src: url('https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/static/woff2/SUIT-Regular.woff2') format('woff2');
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'SUIT', sans-serif;
      display: flex;
      height: 100vh;
      background: linear-gradient(to bottom, #d7dadd 0%, #c4c9d6 60%, #b0c4db 100%);
    }
    .side-menu {
      width: 220px;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 100px 0;
      gap: 20px;
    }
    .pill-menu {
      margin-top: 13px;
      margin-left: 100px;
      display: flex;
      align-items: center;
      gap: 30px;
      background: rgba(255, 255, 255, 0.3);
      width: 250px;
      padding: 12px 25px;
      border-radius: 9999px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      color: #333;
      font-size: 17px;
      font-weight: 600;
      cursor: pointer;
      backdrop-filter: blur(10px);
    }
    .pill-menu:hover {
      background: rgba(255, 255, 255, 0.6);
    }
    .pill-menu img {
      margin-left: 20px;
      width: 33px;
      height: 33px;
    }
    .main-content {
      flex: 1;
      padding: 40px;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow-y: auto;
      gap: 20px;
      margin-top: 70px;
    }
    .glass-box {
      max-width: 600px;
      width: 100%;
      padding: 20px;
      background: rgba(255, 255, 255, 0.4);
      border-radius: 20px;
      backdrop-filter: blur(15px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
      text-align: center;
    }
    .glass-row-2 {
      display: flex;
      gap: 20px;
      width: 90%;
      text-align: center;
    }
    .glass-col {
      flex: 1;
      background: rgba(255, 255, 255, 0.4);
      border-radius: 20px;
      padding: 40px;
      backdrop-filter: blur(15px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      margin-top: 20px;
    }

    .glass-wrapper {
      width: 100%;
      max-width: 600px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      align-items: center;
    }

    canvas {
      text-align: center;
      margin-top: 20px;
      background: transparent;
      border-radius: 10px;
    }
    #map {
      width: 100%;
      height: 400px;
      border-radius: 10px;
      margin-top: 20px;
    }
    #preview, #croppedResult {
      max-width: 100%;
      max-height: 250px;
      margin-top: 10px;
      border: 1px solid #ccc;
      display: none;
    }
      #calendar-container {
    background-color: rgba(255, 255, 255, 0.4);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 50px;
    max-width: 900px;
    margin: 10px auto;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  }
  .fc-daygrid-day-number {
    font-size: 14px;
  }
  .fc-event-title {
    font-size: 28px !important; /* ì´ëª¨í‹°ì½˜ í¬ê²Œ */
    line-height: 1.2;
  }
  .fc-event-time {
    display: none;
  }
  .fc-event-description {
    font-size: 10px;
    color: #444;
  }
  .emotion-diary-container {
    display: flex;
    flex-direction: row;
    gap: 40px; /* ê° ì»¬ëŸ¼ ì‚¬ì´ ê°„ê²© */
    justify-content: space-between;
    padding: 20px;
  }

  .emotion-diary-container .glass-col {
    flex: 1;
    min-width: 0;
    text-align: center;
  }
  .emotion-table {
    flex: 1.2;
  }
  .emotion-table table {
    width: 100%;
    border-collapse: collapse;
    text-align: center;
    border: none; /* ì „ì²´ í…Œë‘ë¦¬ ì œê±° */
  }
  .emotion-table th, .emotion-table td {
    padding: 10px;
    border-bottom: 1px solid #b2b0b0;
  }
  .emotion-table thead tr {
    border-top: none;
    border-left: none;
    border-right: none;
  }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="apikey.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.140.2/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.140.2/examples/js/loaders/GLTFLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.140.2/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/cropperjs@1.5.13/dist/cropper.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cropperjs@1.5.13/dist/cropper.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
    <!-- í™”ë©´ í•´ìƒë„ì— ë”°ë¼ ê¸€ì í¬ê¸° ëŒ€ì‘(ëª¨ë°”ì¼ ëŒ€ì‘) -->
  <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
  <!-- jquery CDN -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- fullcalendar CDN -->
  <link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.8.0/main.min.css' rel='stylesheet' />
  <script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.8.0/main.min.js'></script>
  <!-- fullcalendar ì–¸ì–´ CDN -->
  <script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.8.0/locales-all.min.js'></script>

</head>
  <body>
    <header>
        <div class="title">Project OS</div>
      
    </header>
    <aside class="side-menu">
      <div class="pill-menu" onclick="showReceiptInput()">
        <img src="image/money2.png" alt="ì…ë ¥"> ì…ë ¥
      </div>
      <div class="pill-menu" onclick="showSpending()">
        <img src="image/graph.png" alt="ê·¸ë˜í”„"> ê·¸ë˜í”„
      </div>
      <!-- <div class="pill-menu" onclick="showEmotion()">
        <img src="image/emotion.png" alt="ê°ì •"> ê°ì •
      </div> -->
      <div class="pill-menu" onclick="showBudget()">
        <img src="image/budget.png" alt="ì˜ˆì‚°"> ì˜ˆì‚°
      </div>
      <div class="pill-menu" onclick="showCalendar()">
        <img src="image/dish.png" alt="ë‹¬ë ¥"> ë‹¬ë ¥
      </div>
      <div class="pill-menu" onclick="showEmotionDiary()">
        <img src="image/emotion.png" alt="ë‹¤ì´ì–´ë¦¬"> ë‹¤ì´ì–´ë¦¬
      </div>
    </aside>
  
    <main class="main-content" id="main"></main>
  
    <script>
        function showReceiptInput() {
    document.getElementById("main").innerHTML = `
      <div class="glass-row-2">
        <div class="glass-col">
          <h3>ì˜¤ëŠ˜ì˜ ì§€ì¶œì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</h3>
          <input type="file" id="upload" accept="image/*" style="padding: 5px 16px; margin-bottom: 20px; border-radius: 8px;"/>
          <img id="preview" />
          <img id="croppedResult" />
          <br>
          <label>ë¶„ì•¼ ì„ íƒ:</label>
          <select id="category"  style="padding: 5px 16px; margin-bottom: 20px; border-radius: 8px;">
            <option value="ì‹ë¹„">ì‹ë¹„</option>
            <option value="êµí†µ">êµí†µ</option>
            <option value="ì‡¼í•‘">ì‡¼í•‘</option>
            <option value="êµ¬ë…">êµ¬ë…</option>
            <option value="ê¸°íƒ€">ê¸°íƒ€</option>
          </select>
          <br><br>
          <button id="confirmCrop" style="margin-top:10px; padding:8px 16px; border:none; background:#83A2DB; color:white; border-radius:8px;"> í¬ë¡­ </button>
          <button onclick="runOCR()" style="margin-top:10px; padding:8px 16px; border:none; background:#83A2DB; color:white; border-radius:8px;"> OCR ì‹¤í–‰ </button>
        </div>
        <div class="glass-col">
          <h3>ì˜¤ëŠ˜ í•˜ë£¨ëŠ” ì–´ë– ì…¨ë‚˜ìš”?</h3>
          <input type="text" id="dailyFeelingInput" placeholder="ì˜ˆ: ê¸°ì˜ë‹¤, í˜ë“¤ì—ˆë‹¤ ë“±" style="width: 100%; padding: 10px; border-radius: 8px;" />
          <div id="feelingSavedMessage" style="font-size: 13px; color: #444; margin-top: 5px; "></div>
          <button onclick="submitDailyFeeling()" style="margin-top:10px;margin-bottom: 50px; padding:8px 16px; border:none; background:#83A2DB; color:white; border-radius:8px;">ì „ì†¡</button>
          <div id="dailyFeelingResult" style="margin-top: 20px; font-weight: bold;"></div>
          <div id="affirmationBox" style="margin-top: 10px;"></div>
        </div>
      </div>

      <div style="text-align: center; margin-top: 20px;">
        <button onclick="toggleResult()" style="padding:10px 20px; background:#CEDDEF; border:none; border-radius:8px; font-weight:bold;">â–¼ OCR ë¶„ì„ ê²°ê³¼ ë³´ê¸°</button>
      </div>
      <div id="resultContainer" style="display: none; margin-top: 10px;">
        <div class="glass-box">
          <h3>OCR ê²°ê³¼</h3>
          <div id="result">OCR ê²°ê³¼ ì˜ì—­</div>
        </div>
      </div>
    `;

    const upload = document.getElementById('upload');
    const preview = document.getElementById('preview');
    const croppedResult = document.getElementById('croppedResult');
    const result = document.getElementById('result');
    let cropper = null;
    let croppedBlob = null;

    upload.addEventListener('change', () => {
      const file = upload.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        preview.src = reader.result;
        preview.style.display = 'block';
        croppedResult.style.display = 'none';
        if (cropper) cropper.destroy();
        cropper = new Cropper(preview, {
          aspectRatio: NaN,
          viewMode: 1
        });
      };
      reader.readAsDataURL(file);
    });

    document.getElementById('confirmCrop').addEventListener('click', () => {
      if (!cropper) return;
      const canvas = cropper.getCroppedCanvas();
      canvas.toBlob(blob => {
        croppedBlob = blob;
        croppedResult.src = URL.createObjectURL(blob);
        croppedResult.style.display = 'block';
        preview.style.display = 'none';
        cropper.destroy();
        cropper = null;
      }, 'image/png');
    });

    window.runOCR = function() {
      if (!croppedBlob) {
        alert("í¬ë¡­ í›„ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”");
        return;
      }
      result.innerText = "OCR ì¸ì‹ ì¤‘...";
      Tesseract.recognize(
        croppedBlob,
        'kor',
        {
          langPath: 'https://tessdata.projectnaptha.com/4.0.0/',
          logger: m => console.log(m)
        }
      ).then(({ data: { text } }) => {
        result.innerText = text;
      }).catch(err => {
        result.innerText = `ì˜¤ë¥˜ ë°œìƒ: ${err.message}`;
      });
    }
  }

  function toggleResult() {
    const container = document.getElementById("resultContainer");
    container.style.display = (container.style.display === "none") ? "block" : "none";
  }

  async function loadAffirmation() {
    try {
      const res = await fetch("https://cors-anywhere.herokuapp.com/https://www.affirmations.dev/");
      if (!res.ok) throw new Error("ë¦¬ì†ŒìŠ¤ ìš”ì²­ ì‹¤íŒ¨");

      const data = await res.json();
      const quote = data.affirmation;

      document.getElementById("affirmationBox").innerHTML = `
        <h3>ì˜¤ëŠ˜ì˜ ê¸ì • ë¬¸êµ¬ ğŸŒ¼</h3>
        <p style="font-size:18px;">"${quote}"</p>
      `;
    } catch (err) {
      document.getElementById("affirmationBox").innerHTML = `<p>ê¸ì • ë¬¸êµ¬ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>`;
      console.error("ì˜¤ë¥˜ ë°œìƒ:", err);
    }
  }

  function submitDailyFeeling() {
    const input = document.getElementById("dailyFeelingInput").value.trim();
    const resultBox = document.getElementById("dailyFeelingResult");
    const affirmationBox = document.getElementById("affirmationBox");
    const savedMsg = document.getElementById("feelingSavedMessage");

    if (!input) {
      resultBox.innerText = "ê°ì •ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";
      affirmationBox.innerHTML = "";
      savedMsg.innerText = "";
      return;
    }

    savedMsg.innerText = "ì˜¤ëŠ˜ì˜ ê°ì •ì„ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤.";

    const negativeEmotions = ["ìŠ¬í””", "ë¶ˆì•ˆ", "ë¶„ë…¸", "ìš°ìš¸", "ì§œì¦", "í˜ë“¤"];
    const isNegative = negativeEmotions.some(emotion => input.includes(emotion));

    if (input.includes("í–‰ë³µ") || input.includes("ê¸°ì¨") || input.includes("ì¢‹ì•˜")) {
      resultBox.innerText = "ì˜¤ëŠ˜ í•˜ë£¨ëŠ” í–‰ë³µí•˜ì…¨êµ°ìš” ğŸ˜Š";
      affirmationBox.innerHTML = "";
    } else if (isNegative) {
      resultBox.innerText = "ì˜¤ëŠ˜ ë§ì´ í˜ë“œì…¨êµ°ìš” ğŸ˜¢ ë‚´ì¼ì€ ë” ì¢‹ì•„ì§ˆ ê±°ì˜ˆìš”.";
      affirmationBox.innerHTML = `ê¸ì • ë¬¸êµ¬ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...`;
      loadAffirmation();
    } else {
      resultBox.innerText = "";
      affirmationBox.innerHTML = "";
    }
  }

      function showBudget() {
        document.getElementById("main").innerHTML = `
          <div class="glass-box">
            <h2>ì´ë²ˆ ë‹¬ ì˜ˆì‚°</h2>
            <input type="number" id="totalBudget" placeholder="ì´ ì˜ˆì‚° ì…ë ¥ (â‚©)" style="padding: 5px 16px; margin-bottom: 20px; border-radius: 8px;"/>
            <input type="number" id="usedBudget" placeholder="ì‚¬ìš©í•œ ê¸ˆì•¡ ì…ë ¥ (â‚©)" style="padding: 5px 16px; margin-bottom: 20px; border-radius: 8px;"/>
            <button onclick="drawChart()" style="margin-top:10px; padding:8px 16px; border:none; background:#83A2DB; color:white; border-radius:8px;">í•œëˆˆì— í™•ì¸</button>
            <canvas id="budgetChart" width="300" height="300"></canvas>
          </div>
        `;
      }
  
      function drawChart() {
        const total = parseInt(document.getElementById("totalBudget").value);
        const used = parseInt(document.getElementById("usedBudget").value);
        const remain = total - used;
  
        const ctx = document.getElementById('budgetChart').getContext('2d');
        new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels: ['ì‚¬ìš©í•œ ê¸ˆì•¡', 'ë‚¨ì€ ê¸ˆì•¡'],
            datasets: [{
              data: [used, remain],
              backgroundColor: ['#CE6969', '#83A2DB'],
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                position: 'bottom',
                labels: {
                  font: {
                    family: 'SUIT',
                    size: 14
                  }
                }
              }
            }
          }
        });
      }
  
function showEmotionDiary() {
  document.getElementById("main").innerHTML = `
    <div id="calendar-view">
  <div class="emotion-diary-container">
    <div class="glass-col emotion-table">
      <h2 style="text-align:center; font-weight:bold;">ê°ì • ë‹¤ì´ì–´ë¦¬</h2>
      <table>
        <thead>
          <tr>
            <th>ë‚ ì§œ</th>
            <th>ê°ì •</th>
            <th>ê·¸ë‚ ì˜ ë¬¸ì¥</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>05/20</td>
            <td>ğŸ˜¢</td>
            <td>ì‹œí—˜ë•Œë¬¸ì— í˜ë“¤ì–´</td>
          </tr>
          <tr>
            <td>05/19</td>
            <td>ğŸ˜¡</td>
            <td>ì¹œêµ¬ì—ê²Œ ì‹¤ë§í–ˆì–´</td>
          </tr>
          <tr>
            <td>05/18</td>
            <td>ğŸ˜Š</td>
            <td>ì¢‹ì€ ë‚ ì”¨ ë•ë¶„ì— ì‚°ì±…í–ˆì–´</td>
          </tr>
          <tr>
            <td>05/17</td>
            <td>ğŸ˜Š</td>
            <td>~~~~</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="glass-col" style="flex: 1;">
              <h3 style="font-size:25px;">ì´ë²ˆ ì£¼ì˜ ê°ì •</h3>
              <canvas id="threeCanvas" style="width: 100%; height: 300px;"></canvas>
    </div>
  </div>
</div>
  `;
 init3D(); // 3D ì„¤ì •
}

  function showSpending() {
  document.getElementById("main").innerHTML = `
    <div class="glass-box">
      <h2></h2>
      <select id="chartSelector" style="padding: 8px 16px; margin-bottom: 20px; border-radius: 8px;">
        <option value="emotionTotal">ê°ì •ë³„ ì§€ì¶œ ì´ì•¡</option>
        <option value="dailyEmotion">ì¼ë³„ ê°ì •ê³¼ ì§€ì¶œ</option>
        <option value="dailyTotal">ì¼ë³„ ì§€ì¶œ</option>
        <option value="categoryTotal">ì¹´í…Œê³ ë¦¬ë³„ ì§€ì¶œ</option>
      </select>
      <canvas id="spendingChart" height="300"></canvas>
    </div>
  `;

  const ctx = document.getElementById("spendingChart").getContext("2d");
  let chart;

  document.getElementById("chartSelector").addEventListener("change", drawSelectedChart);

  function drawSelectedChart() {
    const selected = document.getElementById("chartSelector").value;
    if (chart) chart.destroy();

    switch (selected) {
      case "emotionTotal":
        drawEmotionTotalChart(); break;
      case "dailyEmotion":
        drawDailyEmotionChart(); break;
      case "dailyTotal":
        drawDailySpendingChart(); break;
      case "categoryTotal":
        drawCategoryChart(); break;
    }
  }

  function drawEmotionTotalChart() {
  const data = [
    { emotion: "ìŠ¬í””", value: 55000 },
    { emotion: "ë³´í†µ", value: 25000 },
    { emotion: "ë¶„ë…¸", value: 10000 },
    { emotion: "ê¸°ì¨", value: 7000 }
  ];

  const total = data.reduce((sum, item) => sum + item.value, 0);
  const labels = data.map(d => d.emotion);
  const values = data.map(d => d.value);
  const percents = data.map(d => Math.round((d.value / total) * 100));
  const colors = ['#83A2DB', '#84d9c0', '#ff7aa2', '#f7c873'];

  // ê°€ì¥ ë§ì€ ê°ì • ì°¾ê¸°
  const maxIndex = values.indexOf(Math.max(...values));
  const topEmotion = labels[maxIndex];
  const topColor = colors[maxIndex];

  // ë¬¸êµ¬ DOMì´ ì—†ìœ¼ë©´ ì‚½ì…
  const chartContainer = document.querySelector(".glass-box");
  if (!document.getElementById('emotionSummary')) {
    const summary = document.createElement('h3');
    summary.id = 'emotionSummary';
    summary.style.textAlign = 'center';
    summary.style.marginBottom = '15px';
    chartContainer.insertBefore(summary, chartContainer.querySelector("canvas"));
  }

  // ë¬¸êµ¬ í…ìŠ¤íŠ¸ ê°±ì‹ 
  document.getElementById("emotionSummary").innerHTML =
    `ì´ë²ˆ ë‹¬ ì§€ì¶œì€ <span style="color:${topColor}; font-weight:bold; font-size:30px">${topEmotion}</span>ì´ ê°€ì¥ ë§ì•„ìš”`;

  // ì°¨íŠ¸ ê·¸ë¦¬ê¸°
  const ctx = document.getElementById("spendingChart").getContext("2d");
  chart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: 'ì§€ì¶œ ì´ì•¡',
        data: values,
        backgroundColor: colors,
        borderRadius: 10
      }]
    },
    options: {
      indexAxis: 'y',
      plugins: {
        tooltip: {
          callbacks: {
            label: function (ctx) {
              return `â‚©${ctx.raw.toLocaleString()} (${percents[ctx.dataIndex]}%)`;
            }
          }
        },
        legend: { display: false }
      },
      scales: {
        x: { beginAtZero: true }
      }
    }
  });
}


  // function drawEmotionTotalChart() {
    
  //   const data = [
  //     { emotion: "ìŠ¬í””", value: 55000 },
  //     { emotion: "ë³´í†µ", value: 25000 },
  //     { emotion: "ë¶„ë…¸", value: 10000 },
  //     { emotion: "ê¸°ì¨", value: 7000 }
  //   ];
  //   const total = data.reduce((sum, item) => sum + item.value, 0);
  //   const labels = data.map(d => d.emotion);
  //   const values = data.map(d => d.value);
  //   const percents = data.map(d => Math.round((d.value / total) * 100));

  //   chart = new Chart(ctx, {
  //     type: 'bar',
  //     data: {
  //       labels: labels,
  //       datasets: [{
  //         label: 'ì§€ì¶œ ì´ì•¡',
  //         data: values,
  //         backgroundColor: ['#83A2DB', '#84d9c0', '#ff7aa2', '#f7c873'],
  //         borderRadius: 10
  //       }]
  //     },
  //     options: {
  //       indexAxis: 'y',
  //       plugins: {
  //         tooltip: {
  //           callbacks: {
  //             label: function(ctx) {
  //               return `â‚©${ctx.raw.toLocaleString()} (${percents[ctx.dataIndex]}%)`;
  //             }
  //           }
  //         },
  //         legend: { display: false }
  //       },
  //       scales: {
  //         x: { beginAtZero: true }
  //       }
  //     }
  //   });
  // }

  function drawDailyEmotionChart() {
    const data = [
      { date: "5/25", emotion: "ìŠ¬í””", value: 50000 },
      { date: "5/26", emotion: "ë¶ˆì•ˆ", value: 30000 },
      { date: "5/27", emotion: "ê¸°ì¨", value: 20000 }
    ];
    chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: data.map(d => d.date),
        datasets: [{
          label: 'ì¼ë³„ ê°ì •ë³„ ì§€ì¶œ',
          data: data.map(d => d.value),
          fill: false,
          borderColor: '#83A2DB',
          tension: 0.3
        }]
      },
      options: {
        plugins: {
          tooltip: {
            callbacks: {
              label: function(ctx) {
                const item = data[ctx.dataIndex];
                return `ë‚ ì§œ: ${item.date}, ê·¸ë‚ ì˜ ê°ì •: ${item.emotion}, ì§€ì¶œ: â‚©${item.value.toLocaleString()}`;
              }
            }
          },
          legend: { display: false }
        },
        scales: {
          y: { beginAtZero: true }
        }
      }
    });
  }

  function drawDailySpendingChart() {
    const data = [
      { date: "5/25", value: 40000 },
      { date: "5/26", value: 60000 },
      { date: "5/27", value: 35000 }
    ];
    chart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: data.map(d => d.date),
        datasets: [{
          label: 'í•˜ë£¨ ì§€ì¶œ',
          data: data.map(d => d.value),
          backgroundColor: '#83A2DB',
          borderRadius: 8
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false }
        },
        scales: {
          y: { beginAtZero: true }
        }
      }
    });
  }

  function drawCategoryChart() {
    const data = [
      { category: "ì‹ë¹„", value: 30000 },
      { category: "ì‡¼í•‘", value: 20000 },
      { category: "êµí†µ", value: 10000 }
    ];
    chart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: data.map(d => d.category),
        datasets: [{
          label: 'ì¹´í…Œê³ ë¦¬ë³„ ì§€ì¶œ',
          data: data.map(d => d.value),
          backgroundColor: '#83A2DB',
          borderRadius: 8
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false }
        },
        scales: {
          y: { beginAtZero: true }
        }
      }
    });
  }

  drawSelectedChart();
}


  function showCalendar() {
    document.getElementById("main").innerHTML = `
      <div id='calendar-container'>
        <div id='calendar'></div>
      </div>
    `;

    const calendarEl = document.getElementById('calendar');
    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      locale: 'ko',
      height: 'auto',
      headerToolbar: {
        left: '',
        center: 'title',
        right: ''
      },
        events: [
        {
          start: '2025-05-01',
          extendedProps: {
            emoji: 'ğŸ˜¢',
            amount: 12000
          }
        },
        {
          start: '2025-05-02',
          extendedProps: {
            emoji: 'ğŸ˜Š',
            amount: 6500
          }
        },
        {
          start: '2025-05-03',
          extendedProps: {
            emoji: 'ğŸ˜',
            amount: 3000
          }
        },
        {
          start: '2025-05-04',
          extendedProps: {
            emoji: 'ğŸ˜¢',
            amount: 9000
          }
        },
        {
          start: '2025-05-05',
          extendedProps: {
            emoji: 'ğŸ˜Š',
            amount: 21000
          }
        },
        {
          start: '2025-05-06',
          extendedProps: {
            emoji: 'ğŸ˜ ',
            amount: 143000
          }
        },
                {
          start: '2025-05-07',
          extendedProps: {
            emoji: 'ğŸ˜¢',
            amount: 12000
          }
        },
        {
          start: '2025-05-08',
          extendedProps: {
            emoji: 'ğŸ˜Š',
            amount: 6500
          }
        },
        {
          start: '2025-05-09',
          extendedProps: {
            emoji: 'ğŸ˜',
            amount: 3000
          }
        },
        {
          start: '2025-05-10',
          extendedProps: {
            emoji: 'ğŸ˜¢',
            amount: 9000
          }
        },
        {
          start: '2025-05-11',
          extendedProps: {
            emoji: 'ğŸ˜Š',
            amount: 21000
          }
        },
        {
          start: '2025-05-12',
          extendedProps: {
            emoji: 'ğŸ˜ ',
            amount: 143000
          }
        },
        {
          start: '2025-05-13',
          extendedProps: {
            emoji: 'ğŸ˜¢',
            amount: 12000
          }
        },
        {
          start: '2025-05-14',
          extendedProps: {
            emoji: 'ğŸ˜Š',
            amount: 6500
          }
        },
        {
          start: '2025-05-15',
          extendedProps: {
            emoji: 'ğŸ˜',
            amount: 3000
          }
        },
        {
          start: '2025-05-16',
          extendedProps: {
            emoji: 'ğŸ˜¢',
            amount: 9000
          }
        },
        {
          start: '2025-05-17',
          extendedProps: {
            emoji: 'ğŸ˜Š',
            amount: 21000
          }
        },
        {
          start: '2025-05-18',
          extendedProps: {
            emoji: 'ğŸ˜ ',
            amount: 143000
          }
        },
                {
          start: '2025-05-19',
          extendedProps: {
            emoji: 'ğŸ˜¢',
            amount: 12000
          }
        },
        {
          start: '2025-05-20',
          extendedProps: {
            emoji: 'ğŸ˜Š',
            amount: 6500
          }
        },
        {
          start: '2025-05-21',
          extendedProps: {
            emoji: 'ğŸ˜',
            amount: 3000
          }
        },
        {
          start: '2025-05-22',
          extendedProps: {
            emoji: 'ğŸ˜¢',
            amount: 9000
          }
        },
        {
          start: '2025-05-23',
          extendedProps: {
            emoji: 'ğŸ˜Š',
            amount: 21000
          }
        },
        {
          start: '2025-05-24',
          extendedProps: {
            emoji: 'ğŸ˜ ',
            amount: 143000
          }
        }
      ],
      eventContent: function (arg) {
        const { emoji, amount } = arg.event.extendedProps;
        const wrapper = document.createElement('div');
        wrapper.innerHTML = `
          <div style="font-size:35px;">${emoji}</div>
          <div style="font-size:12px; color:#444;">â‚©${amount.toLocaleString()}</div>
        `;
        return { domNodes: [wrapper] };
      },
      eventDidMount: function (info) {
        info.el.style.backgroundColor = 'transparent';
        info.el.style.border = 'none';
        info.el.style.textAlign = 'center';
      }});

    calendar.render();
  }

      let scene, camera, renderer, model,controls;
    
      function showEmotion() {
        document.getElementById("main").innerHTML = `
          <div class="glass-row-2" style="max-width: 800px; width: 100%;">
            <div class="glass-col" style="flex: 1;">
              <h3>ê°ì •ì„ ì…ë ¥í•˜ì„¸ìš”</h3>
              <input type="text" id="emotionInput" placeholder="í–‰ë³µ, ìŠ¬í””, ë¶ˆì•ˆ, ë¶„ë…¸"
                style="width: 100%; padding: 10px; border-radius: 8px;" />
              <button onclick="loadEmotionModel()" 
                style="margin-top:10px; padding:8px 16px; border:none; background:#83A2DB; color:white; border-radius:8px;">
                ì ìš©
              </button>
            </div>
            <div class="glass-col" style="flex: 1;">
              <h3>ê°ì • ìºë¦­í„°</h3>
              <canvas id="threeCanvas" style="width: 100%; height: 300px;"></canvas>
            </div>
          </div>

          <!-- ê¸ì • ë¬¸êµ¬ ë°•ìŠ¤ëŠ” ì²˜ìŒì—” ë¹„ì›Œë‘ê³  ë‚˜ì¤‘ì— ì¡°ê±´ì— ë”°ë¼ ì‚½ì… -->
          <div class="glass-box" id="affirmationBox" style="max-width: 800px; display: none;">
          </div>
        `;

        init3D(); // 3D ì„¤ì •
      }





    function init3D() {
      const canvas = document.getElementById('threeCanvas');
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(45, canvas.clientWidth / canvas.clientHeight, 0.1, 1000);
      camera.position.set(0, 1.5,80);  // ë©€ë¦¬ì„œ ë³´ê¸°

      renderer = new THREE.WebGLRenderer({ canvas, alpha: true, antialias: true });
      renderer.setSize(canvas.clientWidth, canvas.clientHeight);
      renderer.setPixelRatio(window.devicePixelRatio);
      renderer.setClearColor(0x000000, 0);  // íˆ¬ëª… ë°°ê²½

      // ì¡°ëª…
      const ambientLight = new THREE.AmbientLight(0xffffff, 1.2);
      const directionalLight = new THREE.DirectionalLight(0xffffff, 1.5);
      directionalLight.position.set(5, 10, 7.5);
      scene.add(ambientLight, directionalLight);

      controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enablePan = false;
      controls.enableZoom = false;
      controls.target.set(0, 0, 0);  // ëª¨ë¸ ì¤‘ì‹¬
      controls.update();


      // ë¦¬ì‚¬ì´ì¦ˆ ëŒ€ì‘
      window.addEventListener('resize', () => {
        const width = canvas.clientWidth;
        const height = canvas.clientHeight;
        camera.aspect = width / height;
        camera.updateProjectionMatrix();
        renderer.setSize(width, height);
      });

      animate(); // ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
    }

    function loadEmotionModel() {
      const input = document.getElementById("emotionInput").value.trim();
      const map = {
        'í–‰ë³µ': 'happy.glb',
        'ìŠ¬í””': 'sad.glb',
        'ë¶ˆì•ˆ': 'anxious.glb',
        'ë¶„ë…¸': 'angry.glb'
      };
      const fileName = map[input];
      if (!fileName) {
        alert("ê°ì •ì€ 'í–‰ë³µ', 'ìŠ¬í””', 'ë¶ˆì•ˆ', 'ë¶„ë…¸' ì¤‘ì—ì„œ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }

      const loader = new THREE.GLTFLoader();
      loader.load(`models/${fileName}`, (gltf) => {
      if (model) scene.remove(model);

      model = gltf.scene;

      // í¬ê¸°ì™€ ìœ„ì¹˜ ì¡°ì •
      model.scale.set(0.06,0.06,0.06);   // ìºë¦­í„° ì‚¬ì´ì¦ˆ ì¡°ì ˆ
      model.position.set(0, -20, 0);   // ì•„ë˜ë¡œ

      model.rotation.y = 0; // ìºë¦­í„°ê°€ ì•ì„ ë³´ë„ë¡

      // ëª¨ë¸ ë‚´ë¶€ êµ¬ì¡° í™•ì¸
      model.traverse((child) => {
        if (child.isMesh) {
          child.castShadow = true;
          child.receiveShadow = true;
          console.log("Mesh:", child.name);
        }
      });

      scene.add(model);
      console.log("ëª¨ë¸ ì”¬ì— ì¶”ê°€");
      });

    // // ê°ì •ì— ë”°ë¼ ê¸ì • ë¬¸êµ¬ ë°•ìŠ¤ë¥¼ ë³´ì—¬ì£¼ê¸°
    //   const negativeEmotions = ['ìŠ¬í””', 'ë¶„ë…¸', 'ë¶ˆì•ˆ'];
    //   if (negativeEmotions.includes(input)) {
    //     document.getElementById("affirmationBox").style.display = "block";

    //     document.getElementById("affirmationBox").innerHTML = `
    //       <div class="glass-box" id="affirmationBox" style="width: 100%; style="max-width: 800px;">
    //         ê¸ì • ë¬¸êµ¬ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
    //       </div>
    //   `;

    //     loadAffirmation();
    //   } else {
    //     document.getElementById("affirmationBox").style.display = "none";
    //     document.getElementById("affirmationBox").innerHTML = '';
    //   }



    }

    function animate() {
      requestAnimationFrame(animate);
      if (model) model.rotation.y += 0.005;  // ì²œì²œíˆ íšŒì „
      if (controls) controls.update();  // ë§ˆìš°ìŠ¤ íšŒì „ ì ìš©

      renderer.render(scene, camera);
    }


    // function loadAffirmation() {
    //   fetch("https://cors-anywhere.herokuapp.com/https://zenquotes.io/api/random")
    //     .then(res => res.json())
    //     .then(data => {
    //       const quote = data[0].q;
    //       const author = data[0].a;
    //       document.getElementById("affirmationBox").innerHTML = `
    //         <h2>ì˜¤ëŠ˜ì˜ ê¸ì • ë¬¸êµ¬ ğŸŒ¼</h2>
    //         <p style="font-size:18px;">"${quote}"</p>
    //         <p style="font-size:14px;color:gray;">â€” ${author}</p>
    //       `;
    //     })
    //     .catch(err => {
    //       document.getElementById("affirmationBox").innerHTML = `<p>ê¸ì • ë¬¸êµ¬ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>`;
    //     });
    // }


    // // affirmation.js
    // async function loadAffirmation() {
    //   try {
    //     const res = await fetch("https://cors-anywhere.herokuapp.com/https://www.affirmations.dev/");
    //     if (!res.ok) throw new Error("ë¦¬ì†ŒìŠ¤ ìš”ì²­ ì‹¤íŒ¨");

    //     const data = await res.json();
    //     const quote = data.affirmation;

    //     document.getElementById("affirmationBox").innerHTML = `
    //       <h2>ì˜¤ëŠ˜ì˜ ê¸ì • ë¬¸êµ¬ ğŸŒ¼</h2>
    //       <p style="font-size:18px;">"${quote}"</p>
    //     `;
    //   } catch (err) {
    //     document.getElementById("affirmationBox").innerHTML = `<p>ê¸ì • ë¬¸êµ¬ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>`;
    //     console.error("ì˜¤ë¥˜ ë°œìƒ:", err);
    //   }
    // }


    //     async function loadAffirmation() {
//   try {
//     // 1. ê¸ì • ë¬¸êµ¬ ê°€ì ¸ì˜¤ê¸° (ì˜ì–´)
//     const res = await fetch("https://cors-anywhere.herokuapp.com/https://www.affirmations.dev/");
//     if (!res.ok) throw new Error("ë¦¬ì†ŒìŠ¤ ìš”ì²­ ì‹¤íŒ¨");

//     const data = await res.json();
//     const quote = data.affirmation;

//     // 2. ì˜ì–´ ë¬¸êµ¬ë¥¼ í•œêµ­ì–´ë¡œ ë²ˆì—­ (LibreTranslate API ì‚¬ìš©)
//     const translateRes = await fetch("https://cors-anywhere.herokuapp.com/https://libretranslate.de/translate", {
//       method: "POST",
//       headers: {
//         "Content-Type": "application/json"
//       },
//       body: JSON.stringify({
//         q: quote,
//         source: "en",
//         target: "ko",
//         format: "text"
//       })
//     });

//     const translatedData = await translateRes.json();
//     const translated = translatedData.translatedText;

//     // 3. HTMLì— ì¶œë ¥
//     document.getElementById("affirmationBox").innerHTML = `
//       <h2>ì˜¤ëŠ˜ì˜ ê¸ì • ë¬¸êµ¬ ğŸŒ¼</h2>
//       <p style="font-size:18px;">"${quote}"</p>
//       <p style="font-size:14px; color:gray;">â†’ ${translated}</p>
//     `;
//   } catch (err) {
//     document.getElementById("affirmationBox").innerHTML = `<p>ê¸ì • ë¬¸êµ¬ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>`;
//     console.error("ì˜¤ë¥˜ ë°œìƒ:", err);
//   }
// }







    </script>
  </body>
  </html>
  